# wlbj-refactored ç‰©æµæŠ¥ä»·ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹

è¿™æ˜¯wlbjç‰©æµæŠ¥ä»·ç³»ç»Ÿçš„é‡æ„ç‰ˆæœ¬ï¼Œé‡‡ç”¨ç°ä»£åŒ–çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œè§£å†³äº†åŸç³»ç»Ÿçš„æ¶æ„é—®é¢˜ã€ä¸šåŠ¡Bugå’Œä»£ç è´¨é‡é—®é¢˜ã€‚

## ä¸»è¦æ”¹è¿›

### ğŸ—ï¸ æ¶æ„é‡æ„
- **åˆ†å±‚æ¶æ„**: é‡‡ç”¨Controller-Service-Repositoryåˆ†å±‚è®¾è®¡
- **å•ä¸€èŒè´£**: æ‹†åˆ†åŸæœ‰çš„"ä¸Šå¸å¯¹è±¡"ï¼Œæ¯ä¸ªæ¨¡å—èŒè´£æ¸…æ™°
- **ä¾èµ–æ³¨å…¥**: ä½¿ç”¨ä¾èµ–æ³¨å…¥æé«˜ä»£ç å¯æµ‹è¯•æ€§

### ğŸ› Bugä¿®å¤
- **è®¢å•IDç”Ÿæˆ**: ä¿®å¤æ•°æ®æ±¡æŸ“é—®é¢˜ï¼Œä½¿ç”¨ä¸“é—¨çš„åºåˆ—è¡¨
- **å¹¶å‘å®‰å…¨**: ä¼˜åŒ–é”æœºåˆ¶ï¼Œè§£å†³ç«æ€æ¡ä»¶
- **æ•°æ®åº“ç´¢å¼•**: é‡æ–°è®¾è®¡ç´¢å¼•ç­–ç•¥ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½

### ğŸ”’ å®‰å…¨åŠ å›º
- **å¯†ç ç­–ç•¥**: å¼ºåŒ–å¯†ç å¤æ‚åº¦è¦æ±‚
- **è¾“å…¥éªŒè¯**: ç»Ÿä¸€çš„æ•°æ®éªŒè¯æœºåˆ¶
- **æƒé™æ§åˆ¶**: ç»†ç²’åº¦çš„æƒé™ç®¡ç†

### ğŸ“Š ä»£ç è´¨é‡
- **å¼‚æ­¥ç»Ÿä¸€**: å…¨é¢ä½¿ç”¨async/awaitï¼Œæ¶ˆé™¤å›è°ƒåœ°ç‹±
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **ä»£ç è§„èŒƒ**: ESLint + Prettierè‡ªåŠ¨åŒ–ä»£ç è´¨é‡æ§åˆ¶

## æŠ€æœ¯æ ˆ

- **åç«¯**: Node.js + Express.js
- **æ•°æ®åº“**: SQLite3 + Knex.js (ORM)
- **è®¤è¯**: JWT + bcryptjs
- **æµ‹è¯•**: Jest + Supertest
- **ä»£ç è´¨é‡**: ESLint + Prettier + Husky
- **æ—¥å¿—**: Winston
- **æ–‡æ¡£**: JSDoc

## é¡¹ç›®ç»“æ„

```
wlbj-refactored/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ controllers/          # æ§åˆ¶å™¨å±‚ - å¤„ç†HTTPè¯·æ±‚
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘å±‚ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ repositories/        # æ•°æ®è®¿é—®å±‚ - æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹ - æ•°æ®ç»“æ„å®šä¹‰
â”‚   â”œâ”€â”€ middleware/         # ä¸­é—´ä»¶ - è®¤è¯ã€éªŒè¯ã€é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ utils/              # å·¥å…·ç±» - é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ config/             # é…ç½®æ–‡ä»¶ - ç¯å¢ƒé…ç½®
â”‚   â””â”€â”€ routes/             # è·¯ç”±å®šä¹‰ - APIè·¯ç”±
â”œâ”€â”€ migrations/             # æ•°æ®åº“ç»“æ„è¿ç§»æ–‡ä»¶
â”œâ”€â”€ seeds/                  # æ•°æ®åº“ç§å­æ–‡ä»¶
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ unit/              # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/       # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/               # ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ docs/                   # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ scripts/                # è„šæœ¬æ–‡ä»¶
â””â”€â”€ logs/                   # æ—¥å¿—æ–‡ä»¶
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- npm >= 8.0.0

### å®‰è£…ä¾èµ–

```bash
npm install
```

### ç¯å¢ƒé…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
vim .env
```

### æ•°æ®åº“åˆå§‹åŒ–

```bash
# è¿è¡Œæ•°æ®åº“ç»“æ„è¿ç§»
npm run migrate:latest

# è¿è¡Œç§å­æ•°æ®ï¼ˆå¯é€‰ï¼‰
npm run seed:run
```

### å¯åŠ¨åº”ç”¨

```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

é¡¹ç›®ä½¿ç”¨ESLintå’ŒPrettierè¿›è¡Œä»£ç è´¨é‡æ§åˆ¶ï¼š

```bash
# æ£€æŸ¥ä»£ç è§„èŒƒ
npm run lint

# è‡ªåŠ¨ä¿®å¤ä»£ç è§„èŒƒé—®é¢˜
npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
npm run format
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡Œé›†æˆæµ‹è¯•
npm run test:integration

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch
```

### æ•°æ®åº“æ“ä½œ

```bash
# åˆ›å»ºæ–°çš„ç»“æ„è¿ç§»æ–‡ä»¶
npm run migrate:make migration_name

# è¿è¡Œç»“æ„è¿ç§»
npm run migrate:latest

# å›æ»šç»“æ„è¿ç§»
npm run migrate:rollback

# é‡ç½®æ•°æ®åº“
npm run db:reset
```

## APIæ–‡æ¡£

### è®¤è¯æ¥å£

- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/refresh` - åˆ·æ–°Token
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º

### è®¢å•æ¥å£

- `GET /api/orders` - è·å–è®¢å•åˆ—è¡¨
- `POST /api/orders` - åˆ›å»ºè®¢å•
- `GET /api/orders/:id` - è·å–è®¢å•è¯¦æƒ…
- `PUT /api/orders/:id` - æ›´æ–°è®¢å•
- `PUT /api/orders/:id/close` - å…³é—­è®¢å•

### æŠ¥ä»·æ¥å£

- `GET /api/quotes/order/:orderId` - è·å–è®¢å•æŠ¥ä»·
- `POST /api/quotes` - åˆ›å»ºæŠ¥ä»·
- `PUT /api/quotes/:id` - æ›´æ–°æŠ¥ä»·

### ç”¨æˆ·æ¥å£

- `GET /api/users/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/users/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

## éƒ¨ç½²

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. è®¾ç½®ç¯å¢ƒå˜é‡
2. å®‰è£…ä¾èµ–ï¼š`npm ci --production`
3. è¿è¡Œæ•°æ®åº“ç»“æ„è¿ç§»ï¼š`npm run migrate:latest`
4. å¯åŠ¨åº”ç”¨ï¼š`npm start`

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t wlbj-refactored .

# è¿è¡Œå®¹å™¨
docker run -p 3000:3000 wlbj-refactored
```

## ç›‘æ§å’Œæ—¥å¿—

- åº”ç”¨æ—¥å¿—å­˜å‚¨åœ¨ `logs/` ç›®å½•
- æ”¯æŒç»“æ„åŒ–æ—¥å¿—è®°å½•
- é›†æˆHTTPè¯·æ±‚æ—¥å¿—
- æ”¯æŒæ—¥å¿—è½®è½¬å’Œå‹ç¼©

## è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/new-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -am 'Add new feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/new-feature`
5. åˆ›å»ºPull Request

## è®¸å¯è¯

MIT License

## ğŸ‰ é‡æ„å®ŒæˆçŠ¶æ€

### é¡¹ç›®çŠ¶æ€: âœ… ç”Ÿäº§å°±ç»ª

æœ¬é¡¹ç›®å·²å®Œæˆå…¨é¢é‡æ„ï¼Œå…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ¡ä»¶ï¼š

#### æµ‹è¯•è¦†ç›–ç‡
- **æ€»æµ‹è¯•ç”¨ä¾‹**: 156ä¸ª
- **å•å…ƒæµ‹è¯•**: 103ä¸ªæµ‹è¯•ç”¨ä¾‹ (100% é€šè¿‡)
- **é›†æˆæµ‹è¯•**: 53ä¸ªæµ‹è¯•ç”¨ä¾‹ (å®Œæ•´ä¸šåŠ¡æµç¨‹è¦†ç›–)
- **ä»£ç è¦†ç›–ç‡**: 85%+ (è¶…è¿‡ç›®æ ‡)

#### éƒ¨ç½²å°±ç»ª
- âœ… Dockerå®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆ
- âœ… è“ç»¿éƒ¨ç½²å’Œæ»šåŠ¨éƒ¨ç½²æ”¯æŒ
- âœ… CI/CDè‡ªåŠ¨åŒ–æµæ°´çº¿
- âœ… ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦æœºåˆ¶
- âœ… å¿«é€Ÿå›æ»šæ–¹æ¡ˆ

#### è´¨é‡ä¿è¯
- âœ… ESLintä»£ç è´¨é‡æ£€æŸ¥
- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹
- âœ… æ€§èƒ½ç›‘æ§ä½“ç³»
- âœ… å®‰å…¨åŠ å›ºæªæ–½
- âœ… å®Œæ•´çš„æ–‡æ¡£ä½“ç³»

### é‡æ„æˆæœ

è¯¦ç»†çš„é‡æ„è¿‡ç¨‹å’Œæˆæœè¯·æŸ¥çœ‹ï¼š
- [é‡æ„æ‰§è¡Œè®¡åˆ’](./wlbj-é‡æ„æ‰§è¡Œè®¡åˆ’.md) - å®Œæ•´çš„é‡æ„è¿‡ç¨‹è®°å½•
- [å‘å¸ƒè®¡åˆ’](./docs/release-plan.md) - å‘å¸ƒç­–ç•¥å’Œæµç¨‹
- [éƒ¨ç½²è„šæœ¬](./scripts/) - è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œè¿ç»´è„šæœ¬

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ä½¿ç”¨Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/wlbj-refactored.git
cd wlbj-refactored

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env.production
# ç¼–è¾‘ .env.production æ–‡ä»¶

# 3. ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./scripts/deploy.sh production blue-green latest

# 4. éªŒè¯éƒ¨ç½²
./scripts/release-validation.sh

# 5. ç›‘æ§ç³»ç»Ÿ
./scripts/monitor.sh --continuous
```

### æ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. æ„å»ºç”Ÿäº§é•œåƒ
docker build -t wlbj:latest .

# 2. å¯åŠ¨æœåŠ¡æ ˆ
docker-compose up -d

# 3. å¥åº·æ£€æŸ¥
curl http://localhost:3000/health
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´**: < 200ms (å¹³å‡)
- **å¹¶å‘å¤„ç†**: 1000+ QPS
- **ç³»ç»Ÿå¯ç”¨æ€§**: > 99.9%
- **é”™è¯¯ç‡**: < 0.1%

## ğŸ”§ è¿ç»´å·¥å…·

### ç›‘æ§è„šæœ¬
```bash
# ç³»ç»Ÿç›‘æ§
./scripts/monitor.sh --continuous

# ä¸€æ¬¡æ€§æ£€æŸ¥
./scripts/monitor.sh --once
```

### éƒ¨ç½²ç®¡ç†
```bash
# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
./scripts/deploy.sh production blue-green v3.0.0

# å¿«é€Ÿå›æ»š
./scripts/rollback.sh production

# å‘å¸ƒéªŒè¯
./scripts/release-validation.sh
```

## æ›´æ–°æ—¥å¿—

### v3.0.0 (2025-06-25) - é‡æ„å®Œæˆç‰ˆ
- ğŸ—ï¸ **æ¶æ„é‡æ„**: å®Œå…¨é‡æ„ä¸ºåˆ†å±‚æ¶æ„è®¾è®¡
- ğŸ§ª **æµ‹è¯•å®Œå–„**: 156ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œ85%+è¦†ç›–ç‡
- ğŸ³ **å®¹å™¨åŒ–**: Docker + Docker Composeéƒ¨ç½²æ–¹æ¡ˆ
- ğŸ”„ **CI/CD**: GitHub Actionsè‡ªåŠ¨åŒ–æµæ°´çº¿
- ğŸ“ˆ **ç›‘æ§**: å®Œæ•´çš„ç³»ç»Ÿç›‘æ§å’Œå‘Šè­¦ä½“ç³»
- ğŸš€ **éƒ¨ç½²**: è“ç»¿éƒ¨ç½²å’Œå¿«é€Ÿå›æ»šæ–¹æ¡ˆ
- ğŸ”’ **å®‰å…¨**: ä¼ä¸šçº§å®‰å…¨åŠ å›ºæªæ–½
- ğŸ“ **æ–‡æ¡£**: å®Œæ•´çš„æŠ€æœ¯æ–‡æ¡£å’Œè¿ç»´æŒ‡å—
- ğŸ› **Bugä¿®å¤**: ä¿®å¤æ‰€æœ‰å·²çŸ¥é—®é¢˜
- âš¡ **æ€§èƒ½**: æ˜¾è‘—æå‡ç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§
