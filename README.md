# WLBJç‰©æµæŠ¥ä»·ç³»ç»Ÿ - é‡æ„ç‰ˆ v3.0.0

[![ç‰ˆæœ¬](https://img.shields.io/badge/ç‰ˆæœ¬-v3.0.0-blue.svg)](https://github.com/c1767673917/wlbj-refactored)
[![æŠ€æœ¯æ ˆ](https://img.shields.io/badge/æŠ€æœ¯æ ˆ-Node.js%20%2B%20Express.js-green.svg)](#æŠ€æœ¯æ ˆ)
[![éƒ¨ç½²çŠ¶æ€](https://img.shields.io/badge/éƒ¨ç½²çŠ¶æ€-ç”Ÿäº§å°±ç»ª-success.svg)](#éƒ¨ç½²æŒ‡å—)
[![æµ‹è¯•è¦†ç›–ç‡](https://img.shields.io/badge/æµ‹è¯•è¦†ç›–ç‡-70%25-yellow.svg)](#æµ‹è¯•)

## ğŸ“‹ é¡¹ç›®ç®€ä»‹

WLBJç‰©æµæŠ¥ä»·ç³»ç»Ÿé‡æ„ç‰ˆæ˜¯ä¸€ä¸ªä¸“ä¸šçš„B2Bç‰©æµæŠ¥ä»·ç®¡ç†å¹³å°ï¼Œé‡‡ç”¨ç°ä»£åŒ–åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä¸ºè´§ä¸»å’Œç‰©æµä¾›åº”å•†æä¾›é«˜æ•ˆçš„æŠ¥ä»·å¯¹æ¥æœåŠ¡ã€‚æœ¬ç‰ˆæœ¬å®Œå…¨é‡æ„äº†åŸç³»ç»Ÿæ¶æ„ï¼Œè§£å†³äº†æ¶æ„è®¾è®¡é—®é¢˜ã€ä¸šåŠ¡é€»è¾‘Bugå’Œä»£ç è´¨é‡é—®é¢˜ï¼Œå…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²èƒ½åŠ›ã€‚

### ğŸ¯ æ ¸å¿ƒä»·å€¼

- **æ¶æ„ä¼˜åŒ–**: é‡‡ç”¨Controller-Service-Repositoryåˆ†å±‚æ¶æ„ï¼Œæå‡ä»£ç å¯ç»´æŠ¤æ€§
- **æ€§èƒ½æå‡**: ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢å’Œç´¢å¼•ç­–ç•¥ï¼Œæé«˜ç³»ç»Ÿå“åº”é€Ÿåº¦
- **å®‰å…¨åŠ å›º**: å¼ºåŒ–è®¤è¯æœºåˆ¶ã€è¾“å…¥éªŒè¯å’Œæƒé™æ§åˆ¶
- **éƒ¨ç½²å‹å¥½**: æ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²å’Œè“ç»¿éƒ¨ç½²ç­–ç•¥

## ğŸš€ ä¸»è¦åŠŸèƒ½

### ğŸ‘¤ ç”¨æˆ·ç«¯åŠŸèƒ½

- **è®¢å•ç®¡ç†**: åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€å–æ¶ˆè®¢å•
- **æŠ¥ä»·æ¯”è¾ƒ**: å®æ—¶æŸ¥çœ‹ä¾›åº”å•†æŠ¥ä»·ï¼Œæ™ºèƒ½æ¯”ä»·
- **æ•°æ®å¯¼å‡º**: æ”¯æŒExcelæ ¼å¼æ•°æ®å¯¼å‡º
- **æƒé™ç®¡ç†**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

### ğŸš› ä¾›åº”å•†ç«¯åŠŸèƒ½

- **å¿«é€ŸæŠ¥ä»·**: ç®€åŒ–çš„æŠ¥ä»·æäº¤æµç¨‹
- **æŠ¥ä»·ç®¡ç†**: æŸ¥çœ‹å’Œä¿®æ”¹å·²æäº¤æŠ¥ä»·
- **è®¢å•è·Ÿè¸ª**: å®æ—¶è®¢å•çŠ¶æ€æ›´æ–°

### ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜åŠŸèƒ½

- **ç”¨æˆ·ç®¡ç†**: å®Œæ•´çš„ç”¨æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **ç³»ç»Ÿç›‘æ§**: å¥åº·æ£€æŸ¥å’Œæ€§èƒ½æŒ‡æ ‡
- **æ•°æ®å¤‡ä»½**: è‡ªåŠ¨åŒ–å¤‡ä»½å’Œæ¢å¤æœºåˆ¶

## ğŸ—ï¸ æ¶æ„æ”¹è¿›

### åˆ†å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controller    â”‚ â† HTTPè¯·æ±‚å¤„ç†ï¼Œå‚æ•°éªŒè¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Service      â”‚ â† ä¸šåŠ¡é€»è¾‘ï¼Œäº‹åŠ¡ç®¡ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Repository    â”‚ â† æ•°æ®è®¿é—®ï¼Œæ•°æ®åº“æ“ä½œ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Database     â”‚ â† SQLite/PostgreSQL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ”¹è¿›

- **ğŸ—ï¸ æ¶æ„é‡æ„**: ä»å•ä½“æ–‡ä»¶é‡æ„ä¸ºåˆ†å±‚æ¶æ„ï¼Œä»£ç è¡Œæ•°å‡å°‘63%
- **ğŸ› Bugä¿®å¤**: ä¿®å¤è®¢å•IDç”Ÿæˆæ•°æ®æ±¡æŸ“ã€å¹¶å‘å®‰å…¨ç­‰å…³é”®é—®é¢˜
- **ğŸ”’ å®‰å…¨åŠ å›º**: å¼ºåŒ–å¯†ç ç­–ç•¥ã€è¾“å…¥éªŒè¯å’Œæƒé™æ§åˆ¶
- **ğŸ“Š ä»£ç è´¨é‡**: ç»Ÿä¸€å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œå»ºç«‹å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
- **ğŸ§ª æµ‹è¯•è¦†ç›–**: å»ºç«‹å®Œæ•´çš„å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’ŒE2Eæµ‹è¯•ä½“ç³»

## ğŸ’» æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯

- **è¿è¡Œæ—¶**: Node.js >= 18.0.0
- **æ¡†æ¶**: Express.js 4.18+
- **æ•°æ®åº“**: SQLite3 / PostgreSQL (ç”Ÿäº§ç¯å¢ƒæ¨è)
- **ORM**: Knex.js 3.1+
- **è®¤è¯**: JWT + bcryptjs
- **æ—¥å¿—**: Winston 3.17+

### å¼€å‘å·¥å…·

- **æµ‹è¯•**: Jest + Supertest
- **ä»£ç è´¨é‡**: ESLint + Prettier + Husky
- **æ–‡æ¡£**: JSDoc
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **CI/CD**: GitHub Actions

## ğŸ“ é¡¹ç›®ç»“æ„

```
wlbj-refactored/
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ controllers/        # æ§åˆ¶å™¨å±‚ - HTTPè¯·æ±‚å¤„ç†å’Œå‚æ•°éªŒè¯
â”‚   â”‚   â”œâ”€â”€ OrderController.js
â”‚   â”‚   â”œâ”€â”€ QuoteController.js
â”‚   â”‚   â””â”€â”€ UserController.js
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘å±‚ - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œäº‹åŠ¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ OrderService.js
â”‚   â”‚   â”œâ”€â”€ QuoteService.js
â”‚   â”‚   â”œâ”€â”€ UserService.js
â”‚   â”‚   â””â”€â”€ NotificationService.js
â”‚   â”œâ”€â”€ repositories/      # æ•°æ®è®¿é—®å±‚ - æ•°æ®åº“æ“ä½œå’ŒæŸ¥è¯¢
â”‚   â”‚   â”œâ”€â”€ OrderRepository.js
â”‚   â”‚   â”œâ”€â”€ QuoteRepository.js
â”‚   â”‚   â””â”€â”€ UserRepository.js
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶ - è®¤è¯ã€éªŒè¯ã€å®‰å…¨ã€é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ validation.js
â”‚   â”‚   â”œâ”€â”€ security.js
â”‚   â”‚   â””â”€â”€ errorHandler.js
â”‚   â”œâ”€â”€ utils/             # å·¥å…·ç±» - é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶ - ç¯å¢ƒé…ç½®å’Œæ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ routes/            # è·¯ç”±å®šä¹‰ - APIè·¯ç”±æ¨¡å—åŒ–ç®¡ç†
â”‚   â””â”€â”€ app.js             # åº”ç”¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ migrations/            # æ•°æ®åº“è¿ç§»æ–‡ä»¶ - ç‰ˆæœ¬åŒ–æ•°æ®åº“ç»“æ„
â”œâ”€â”€ seeds/                 # æ•°æ®åº“ç§å­æ–‡ä»¶ - æµ‹è¯•æ•°æ®
â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ unit/             # å•å…ƒæµ‹è¯• - Serviceå’ŒRepositoryå±‚æµ‹è¯•
â”‚   â”œâ”€â”€ integration/      # é›†æˆæµ‹è¯• - APIæ¥å£æµ‹è¯•
â”‚   â””â”€â”€ e2e/              # ç«¯åˆ°ç«¯æµ‹è¯• - å®Œæ•´ä¸šåŠ¡æµç¨‹æµ‹è¯•
â”œâ”€â”€ docs/                  # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ deployment-guide.md
â”‚   â””â”€â”€ api-documentation.md
â”œâ”€â”€ scripts/               # éƒ¨ç½²å’Œè¿ç»´è„šæœ¬
â”‚   â”œâ”€â”€ deploy.sh         # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ start.sh          # å¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ monitor.sh        # ç›‘æ§è„šæœ¬
â”œâ”€â”€ nginx/                 # Nginxé…ç½®æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml     # Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ Dockerfile            # Dockeré•œåƒæ„å»ºæ–‡ä»¶
â””â”€â”€ logs/                 # æ—¥å¿—æ–‡ä»¶ç›®å½•
```

## âš¡ å¿«é€Ÿå¼€å§‹

### ğŸ“‹ ç³»ç»Ÿè¦æ±‚

#### åŸºç¡€ç¯å¢ƒ

- **Node.js**: >= 18.0.0 (æ¨è 18.x LTS)
- **npm**: >= 8.0.0
- **å†…å­˜**: æœ€å°‘ 512MBï¼Œæ¨è 2GB+
- **ç£ç›˜**: æœ€å°‘ 1GB å¯ç”¨ç©ºé—´
- **æ“ä½œç³»ç»Ÿ**: Windows 10+, macOS 10.15+, Ubuntu 18.04+

#### å¯é€‰ç»„ä»¶ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

- **Docker**: >= 20.10.0 (å®¹å™¨åŒ–éƒ¨ç½²)
- **PostgreSQL**: >= 12.0 (æ›¿ä»£SQLite)
- **Redis**: >= 6.0 (ç¼“å­˜åŠ é€Ÿ)
- **Nginx**: >= 1.18 (åå‘ä»£ç†)

### ğŸš€ ä¸€é”®å¯åŠ¨ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd wlbj-refactored

# 2. å®‰è£…ä¾èµ–
npm install

# 3. ç¯å¢ƒé…ç½®
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦å‚æ•°

# 4. åˆå§‹åŒ–æ•°æ®åº“
npm run migrate:latest
npm run seed:run  # å¯é€‰ï¼šåŠ è½½æµ‹è¯•æ•°æ®

# 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### ğŸ”§ è¯¦ç»†é…ç½®

#### ç¯å¢ƒå˜é‡é…ç½®

```bash
# åº”ç”¨åŸºç¡€é…ç½®
NODE_ENV=development          # ç¯å¢ƒï¼šdevelopment/production/test
PORT=3000                    # æœåŠ¡ç«¯å£
APP_NAME=wlbj-refactored     # åº”ç”¨åç§°

# æ•°æ®åº“é…ç½®
DB_CLIENT=sqlite3            # æ•°æ®åº“ç±»å‹ï¼šsqlite3/postgresql
DB_FILENAME=./data/logistics.db  # SQLiteæ–‡ä»¶è·¯å¾„

# JWTè®¤è¯é…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=15m           # è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶é—´
JWT_REFRESH_EXPIRES_IN=7d    # åˆ·æ–°ä»¤ç‰Œè¿‡æœŸæ—¶é—´

# å®‰å…¨é…ç½®
BCRYPT_ROUNDS=12             # å¯†ç åŠ å¯†å¼ºåº¦
RATE_LIMIT_MAX_REQUESTS=100  # APIé™æµé…ç½®

# æ—¥å¿—é…ç½®
LOG_LEVEL=info               # æ—¥å¿—çº§åˆ«ï¼šdebug/info/warn/error
LOG_FILE=./logs/app.log      # æ—¥å¿—æ–‡ä»¶è·¯å¾„
```

#### PostgreSQLé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰

```bash
# æ›¿æ¢SQLiteé…ç½®
DB_CLIENT=postgresql
DB_HOST=localhost
DB_PORT=5432
DB_NAME=wlbj
DB_USER=wlbj_user
DB_PASSWORD=your_secure_password
```

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

é¡¹ç›®ä½¿ç”¨ESLintå’ŒPrettierè¿›è¡Œä»£ç è´¨é‡æ§åˆ¶ï¼š

```bash
# æ£€æŸ¥ä»£ç è§„èŒƒ
npm run lint

# è‡ªåŠ¨ä¿®å¤ä»£ç è§„èŒƒé—®é¢˜
npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
npm run format
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡Œé›†æˆæµ‹è¯•
npm run test:integration

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch
```

### æ•°æ®åº“æ“ä½œ

```bash
# åˆ›å»ºæ–°çš„ç»“æ„è¿ç§»æ–‡ä»¶
npm run migrate:make migration_name

# è¿è¡Œç»“æ„è¿ç§»
npm run migrate:latest

# å›æ»šç»“æ„è¿ç§»
npm run migrate:rollback

# é‡ç½®æ•°æ®åº“
npm run db:reset
```

## APIæ–‡æ¡£

### è®¤è¯æ¥å£

- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/refresh` - åˆ·æ–°Token
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º

### è®¢å•æ¥å£

- `GET /api/orders` - è·å–è®¢å•åˆ—è¡¨
- `POST /api/orders` - åˆ›å»ºè®¢å•
- `GET /api/orders/:id` - è·å–è®¢å•è¯¦æƒ…
- `PUT /api/orders/:id` - æ›´æ–°è®¢å•
- `PUT /api/orders/:id/close` - å…³é—­è®¢å•

### æŠ¥ä»·æ¥å£

- `GET /api/quotes/order/:orderId` - è·å–è®¢å•æŠ¥ä»·
- `POST /api/quotes` - åˆ›å»ºæŠ¥ä»·
- `PUT /api/quotes/:id` - æ›´æ–°æŠ¥ä»·

### ç”¨æˆ·æ¥å£

- `GET /api/users/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/users/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

## ğŸš€ éƒ¨ç½²æŒ‡å—

### ğŸ“¦ éƒ¨ç½²æ–¹å¼æ¦‚è§ˆ

æœ¬ç³»ç»Ÿæ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼Œé€‚åº”ä¸åŒçš„ç”Ÿäº§ç¯å¢ƒéœ€æ±‚ï¼š

| éƒ¨ç½²æ–¹å¼       | é€‚ç”¨åœºæ™¯             | å¤æ‚åº¦ | æ¨èæŒ‡æ•°   |
| -------------- | -------------------- | ------ | ---------- |
| **ç›´æ¥éƒ¨ç½²**   | å°å‹é¡¹ç›®ï¼Œå•æœºéƒ¨ç½²   | â­     | â­â­â­     |
| **Dockeréƒ¨ç½²** | å®¹å™¨åŒ–ç¯å¢ƒï¼Œæ˜“äºè¿ç§» | â­â­   | â­â­â­â­â­ |
| **è“ç»¿éƒ¨ç½²**   | ç”Ÿäº§ç¯å¢ƒï¼Œé›¶åœæœºæ›´æ–° | â­â­â­ | â­â­â­â­   |

### ğŸ¯ æ–¹å¼ä¸€ï¼šç›´æ¥éƒ¨ç½²ï¼ˆæ¨èæ–°æ‰‹ï¼‰

#### 1. ç¯å¢ƒå‡†å¤‡

```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version  # åº”è¯¥ >= 18.0.0

# åˆ›å»ºéƒ¨ç½²ç›®å½•
sudo mkdir -p /opt/wlbj
sudo chown $USER:$USER /opt/wlbj
cd /opt/wlbj

# å…‹éš†ä»£ç 
git clone <repository-url> .
```

#### 2. ç”Ÿäº§ç¯å¢ƒé…ç½®

```bash
# å®‰è£…ç”Ÿäº§ä¾èµ–
npm ci --only=production

# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®
cp .env.example .env.production
vim .env.production
```

**ç”Ÿäº§ç¯å¢ƒå¿…éœ€é…ç½®ï¼š**

```bash
NODE_ENV=production
PORT=3000
JWT_SECRET=your_very_secure_random_string_here_min_32_chars
DB_CLIENT=postgresql  # æ¨èä½¿ç”¨PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=wlbj_prod
DB_USER=wlbj_user
DB_PASSWORD=your_secure_database_password
LOG_LEVEL=info
RATE_LIMIT_MAX_REQUESTS=50  # ç”Ÿäº§ç¯å¢ƒæ›´ä¸¥æ ¼é™åˆ¶
```

#### 3. æ•°æ®åº“åˆå§‹åŒ–

```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
NODE_ENV=production npm run migrate:latest

# éªŒè¯æ•°æ®åº“è¿æ¥
node -e "require('./src/config/database').raw('SELECT 1').then(() => console.log('æ•°æ®åº“è¿æ¥æˆåŠŸ')).catch(console.error)"
```

#### 4. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
./scripts/start.sh production

# æˆ–ç›´æ¥å¯åŠ¨
NODE_ENV=production npm start

# ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
npm install -g pm2
pm2 start src/app.js --name wlbj-app --env production
pm2 save
pm2 startup
```

### ğŸ³ æ–¹å¼äºŒï¼šDockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. å•å®¹å™¨éƒ¨ç½²

```bash
# æ„å»ºç”Ÿäº§é•œåƒ
docker build -t wlbj:latest --target runner .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name wlbj-app \
  -p 3000:3000 \
  -e NODE_ENV=production \
  -e JWT_SECRET=your_secure_jwt_secret \
  -e DB_CLIENT=sqlite3 \
  -v /opt/wlbj/data:/app/data \
  -v /opt/wlbj/logs:/app/logs \
  --restart unless-stopped \
  wlbj:latest
```

#### 2. Docker Composeéƒ¨ç½²ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# åˆ›å»ºç¯å¢ƒé…ç½®æ–‡ä»¶
cat > .env << EOF
NODE_ENV=production
DB_NAME=wlbj
DB_USER=wlbj_user
DB_PASSWORD=your_secure_password
JWT_SECRET=your_secure_jwt_secret
REDIS_PASSWORD=your_redis_password
EOF

# å¯åŠ¨å®Œæ•´æœåŠ¡æ ˆ
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f app
```

**Docker ComposeæœåŠ¡åŒ…å«ï¼š**

- **åº”ç”¨æœåŠ¡**: Node.jsåº”ç”¨ä¸»æœåŠ¡
- **PostgreSQL**: ç”Ÿäº§çº§æ•°æ®åº“
- **Redis**: ç¼“å­˜æœåŠ¡
- **Nginx**: åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡

#### 3. å¥åº·æ£€æŸ¥å’Œç›‘æ§

```bash
# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
curl http://localhost/health

# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
docker stats
```

### âš¡ æ–¹å¼ä¸‰ï¼šè“ç»¿éƒ¨ç½²ï¼ˆé›¶åœæœºæ›´æ–°ï¼‰

è“ç»¿éƒ¨ç½²é€‚ç”¨äºå¯¹å¯ç”¨æ€§è¦æ±‚æé«˜çš„ç”Ÿäº§ç¯å¢ƒï¼š

```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬è¿›è¡Œè“ç»¿éƒ¨ç½²
./scripts/deploy.sh production blue-green v3.0.0

# éƒ¨ç½²è¿‡ç¨‹ï¼š
# 1. æ„å»ºæ–°ç‰ˆæœ¬é•œåƒ
# 2. å¯åŠ¨æ–°ç¯å¢ƒï¼ˆç»¿ç¯å¢ƒï¼‰
# 3. å¥åº·æ£€æŸ¥é€šè¿‡ååˆ‡æ¢æµé‡
# 4. åœæ­¢æ—§ç¯å¢ƒï¼ˆè“ç¯å¢ƒï¼‰
```

### ğŸ”§ éƒ¨ç½²åé…ç½®

#### 1. Nginxåå‘ä»£ç†é…ç½®

```nginx
# /etc/nginx/sites-available/wlbj
server {
    listen 80;
    server_name your-domain.com;

    # é‡å®šå‘åˆ°HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSLé…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # åå‘ä»£ç†åˆ°åº”ç”¨
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # APIé™æµ
    location /api/ {
        limit_req zone=api burst=20 nodelay;
        proxy_pass http://localhost:3000;
    }
}
```

#### 2. ç³»ç»ŸæœåŠ¡é…ç½®ï¼ˆsystemdï¼‰

```bash
# åˆ›å»ºç³»ç»ŸæœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/wlbj.service << EOF
[Unit]
Description=WLBJ Logistics Quote System
After=network.target

[Service]
Type=simple
User=wlbj
WorkingDirectory=/opt/wlbj
Environment=NODE_ENV=production
ExecStart=/usr/bin/node src/app.js
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å¯ç”¨å¹¶å¯åŠ¨æœåŠ¡
sudo systemctl enable wlbj
sudo systemctl start wlbj
sudo systemctl status wlbj
```

#### 3. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-service=ssh
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

### ğŸ“Š ç›‘æ§å’Œè¿ç»´

#### 1. å¥åº·æ£€æŸ¥

```bash
# åº”ç”¨å¥åº·æ£€æŸ¥
curl -f http://localhost:3000/health || echo "åº”ç”¨å¼‚å¸¸"

# æ•°æ®åº“è¿æ¥æ£€æŸ¥
curl -f http://localhost:3000/health/db || echo "æ•°æ®åº“å¼‚å¸¸"

# å®Œæ•´ç³»ç»Ÿæ£€æŸ¥
./scripts/validate-production.sh
```

#### 2. æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/app.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/error.log

# ä½¿ç”¨journalctlæŸ¥çœ‹ç³»ç»ŸæœåŠ¡æ—¥å¿—
sudo journalctl -u wlbj -f

# æ—¥å¿—è½®è½¬é…ç½®
sudo tee /etc/logrotate.d/wlbj << EOF
/opt/wlbj/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 wlbj wlbj
    postrotate
        systemctl reload wlbj
    endscript
}
EOF
```

#### 3. æ€§èƒ½ç›‘æ§

```bash
# å®‰è£…ç›‘æ§å·¥å…·
npm install -g pm2

# ä½¿ç”¨PM2ç›‘æ§
pm2 start src/app.js --name wlbj-app
pm2 monit  # å®æ—¶ç›‘æ§ç•Œé¢

# ç³»ç»Ÿèµ„æºç›‘æ§
htop
iostat -x 1
free -h
df -h
```

#### 4. å¤‡ä»½ç­–ç•¥

```bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬
#!/bin/bash
BACKUP_DIR="/opt/backups/wlbj"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
pg_dump -h localhost -U wlbj_user wlbj > $BACKUP_DIR/db_backup_$DATE.sql

# å¤‡ä»½åº”ç”¨æ•°æ®
tar -czf $BACKUP_DIR/app_data_$DATE.tar.gz /opt/wlbj/data

# æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™30å¤©ï¼‰
find $BACKUP_DIR -name "*.sql" -mtime +30 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete

echo "å¤‡ä»½å®Œæˆ: $DATE"
```

### ğŸš¨ æ•…éšœæ’é™¤

#### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. **åº”ç”¨æ— æ³•å¯åŠ¨**

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep :3000

# æ£€æŸ¥ç¯å¢ƒå˜é‡
env | grep NODE_ENV

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
NODE_ENV=production DEBUG=* npm start
```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**

```bash
# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
sudo systemctl status postgresql

# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -h localhost -U wlbj_user -d wlbj -c "SELECT 1;"

# æ£€æŸ¥æ•°æ®åº“é…ç½®
cat .env.production | grep DB_
```

3. **æ€§èƒ½é—®é¢˜**

```bash
# æ£€æŸ¥ç³»ç»Ÿèµ„æº
top
free -h
df -h

# åˆ†ææ…¢æŸ¥è¯¢
tail -f logs/app.log | grep "slow query"

# æ•°æ®åº“æ€§èƒ½åˆ†æ
EXPLAIN ANALYZE SELECT * FROM orders WHERE status = 'active';
```

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- åˆ›å»ºå¿…è¦ç´¢å¼•
CREATE INDEX CONCURRENTLY idx_orders_status_created ON orders(status, created_at);
CREATE INDEX CONCURRENTLY idx_quotes_order_price ON quotes(order_id, price);

-- å®šæœŸç»´æŠ¤
VACUUM ANALYZE;
REINDEX DATABASE wlbj;
```

#### 2. åº”ç”¨å±‚ä¼˜åŒ–

```bash
# å¯ç”¨é›†ç¾¤æ¨¡å¼
NODE_OPTIONS="--max-old-space-size=2048" pm2 start src/app.js -i max

# é…ç½®ç¼“å­˜
export REDIS_URL=redis://localhost:6379
export CACHE_TTL=300
```

#### 3. ç½‘ç»œä¼˜åŒ–

```nginx
# Nginxé…ç½®ä¼˜åŒ–
gzip on;
gzip_types text/plain application/json application/javascript text/css;
client_max_body_size 10M;
keepalive_timeout 65;
```

## ğŸ“š APIæ–‡æ¡£

### ğŸ” è®¤è¯æ¥å£

| æ–¹æ³•   | è·¯å¾„                | æè¿°      | æƒé™   |
| ------ | ------------------- | --------- | ------ |
| `POST` | `/api/auth/login`   | ç”¨æˆ·ç™»å½•  | å…¬å¼€   |
| `POST` | `/api/auth/refresh` | åˆ·æ–°Token | å…¬å¼€   |
| `POST` | `/api/auth/logout`  | ç”¨æˆ·ç™»å‡º  | éœ€è®¤è¯ |

### ğŸ“¦ è®¢å•æ¥å£

| æ–¹æ³•   | è·¯å¾„                    | æè¿°         | æƒé™        |
| ------ | ----------------------- | ------------ | ----------- |
| `GET`  | `/api/orders`           | è·å–è®¢å•åˆ—è¡¨ | ç”¨æˆ·/ç®¡ç†å‘˜ |
| `POST` | `/api/orders`           | åˆ›å»ºè®¢å•     | ç”¨æˆ·/ç®¡ç†å‘˜ |
| `GET`  | `/api/orders/:id`       | è·å–è®¢å•è¯¦æƒ… | ç”¨æˆ·/ç®¡ç†å‘˜ |
| `PUT`  | `/api/orders/:id`       | æ›´æ–°è®¢å•     | ç”¨æˆ·/ç®¡ç†å‘˜ |
| `PUT`  | `/api/orders/:id/close` | å…³é—­è®¢å•     | ç”¨æˆ·/ç®¡ç†å‘˜ |

### ğŸ’° æŠ¥ä»·æ¥å£

| æ–¹æ³•   | è·¯å¾„                         | æè¿°         | æƒé™          |
| ------ | ---------------------------- | ------------ | ------------- |
| `GET`  | `/api/quotes/order/:orderId` | è·å–è®¢å•æŠ¥ä»· | ç”¨æˆ·/ç®¡ç†å‘˜   |
| `POST` | `/api/quotes`                | åˆ›å»ºæŠ¥ä»·     | ä¾›åº”å•†/ç®¡ç†å‘˜ |
| `PUT`  | `/api/quotes/:id`            | æ›´æ–°æŠ¥ä»·     | ä¾›åº”å•†/ç®¡ç†å‘˜ |

### ğŸ‘¤ ç”¨æˆ·æ¥å£

| æ–¹æ³•  | è·¯å¾„                 | æè¿°         | æƒé™   |
| ----- | -------------------- | ------------ | ------ |
| `GET` | `/api/users/profile` | è·å–ç”¨æˆ·ä¿¡æ¯ | éœ€è®¤è¯ |
| `PUT` | `/api/users/profile` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | éœ€è®¤è¯ |
| `GET` | `/api/users`         | è·å–ç”¨æˆ·åˆ—è¡¨ | ç®¡ç†å‘˜ |

### ğŸ“Š ç›‘æ§æ¥å£

| æ–¹æ³•  | è·¯å¾„         | æè¿°           | æƒé™   |
| ----- | ------------ | -------------- | ------ |
| `GET` | `/health`    | å¥åº·æ£€æŸ¥       | å…¬å¼€   |
| `GET` | `/health/db` | æ•°æ®åº“å¥åº·æ£€æŸ¥ | å…¬å¼€   |
| `GET` | `/metrics`   | ç³»ç»ŸæŒ‡æ ‡       | ç®¡ç†å‘˜ |

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•ä½“ç³»æ¶æ„

```
æµ‹è¯•é‡‘å­—å¡”
â”œâ”€â”€ E2Eæµ‹è¯• (16ä¸ªæµ‹è¯•ç”¨ä¾‹) âœ…
â”‚   â”œâ”€â”€ åº”ç”¨å¯åŠ¨æµ‹è¯•
â”‚   â”œâ”€â”€ è®¤è¯æµç¨‹æµ‹è¯•
â”‚   â”œâ”€â”€ è®¢å•ç®¡ç†æµ‹è¯•
â”‚   â”œâ”€â”€ æŠ¥ä»·ç®¡ç†æµ‹è¯•
â”‚   â””â”€â”€ æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ é›†æˆæµ‹è¯• (50ä¸ªæµ‹è¯•ç”¨ä¾‹) âœ…
â”‚   â”œâ”€â”€ è·¯ç”±é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ ä¸­é—´ä»¶æµ‹è¯•
â”‚   â”œâ”€â”€ Controlleræµ‹è¯•
â”‚   â””â”€â”€ å®Œæ•´æµç¨‹æµ‹è¯•
â””â”€â”€ å•å…ƒæµ‹è¯• âœ…
    â”œâ”€â”€ Serviceå±‚æµ‹è¯•
    â”œâ”€â”€ Repositoryå±‚æµ‹è¯•
    â””â”€â”€ å·¥å…·å‡½æ•°æµ‹è¯•
```

### æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡Œé›†æˆæµ‹è¯•
npm run test:integration

# è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:watch

# CIç¯å¢ƒæµ‹è¯•
npm run test:ci
```

### æµ‹è¯•è¦†ç›–ç‡

- **æ€»æµ‹è¯•ç”¨ä¾‹**: 66ä¸ª
- **é€šè¿‡ç‡**: 95.5% (63/66é€šè¿‡)
- **ä»£ç è¦†ç›–ç‡**: 70%+
- **æ§åˆ¶å™¨å±‚è¦†ç›–ç‡**: 95%+
- **æœåŠ¡å±‚è¦†ç›–ç‡**: 90%+

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

```bash
# æ£€æŸ¥ä»£ç è§„èŒƒ
npm run lint

# è‡ªåŠ¨ä¿®å¤ä»£ç è§„èŒƒé—®é¢˜
npm run lint:fix

# æ ¼å¼åŒ–ä»£ç 
npm run format

# å®Œæ•´è´¨é‡æ£€æŸ¥
npm run quality:validate
```

### æ•°æ®åº“æ“ä½œ

```bash
# åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
npm run migrate:make migration_name

# è¿è¡Œè¿ç§»
npm run migrate:latest

# å›æ»šè¿ç§»
npm run migrate:rollback

# é‡ç½®æ•°æ®åº“
npm run db:reset
```

### Gitå·¥ä½œæµ

```bash
# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# æäº¤ä»£ç ï¼ˆä¼šè‡ªåŠ¨è¿è¡Œè´¨é‡æ£€æŸ¥ï¼‰
git add .
git commit -m "feat: add new feature"

# æ¨é€åˆ†æ”¯
git push origin feature/new-feature
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v3.0.0 (2025-06-25) - é‡æ„ç‰ˆæœ¬

#### ğŸ—ï¸ æ¶æ„é‡æ„

- å®Œå…¨é‡æ„ä¸ºåˆ†å±‚æ¶æ„ï¼ˆController-Service-Repositoryï¼‰
- ä»£ç è¡Œæ•°å‡å°‘63%ï¼ˆ300è¡Œ â†’ 109è¡Œä¸»æ–‡ä»¶ï¼‰
- æ¨¡å—åŒ–ç¨‹åº¦æå‡è‡³100%

#### ğŸ› Bugä¿®å¤

- ä¿®å¤è®¢å•IDç”Ÿæˆçš„æ•°æ®æ±¡æŸ“é—®é¢˜
- è§£å†³å¹¶å‘å®‰å…¨å’Œç«æ€æ¡ä»¶é—®é¢˜
- ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•ç­–ç•¥ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½

#### ğŸ”’ å®‰å…¨åŠ å›º

- å¼ºåŒ–å¯†ç å¤æ‚åº¦è¦æ±‚å’ŒJWTè®¤è¯æœºåˆ¶
- ç»Ÿä¸€è¾“å…¥éªŒè¯å’Œé”™è¯¯å¤„ç†æœºåˆ¶
- å®ç°ç»†ç²’åº¦æƒé™æ§åˆ¶

#### ğŸ“Š ä»£ç è´¨é‡

- ç»Ÿä¸€å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼ˆasync/awaitï¼‰
- å»ºç«‹å®Œæ•´çš„ESLint + Prettierä»£ç è´¨é‡æ§åˆ¶
- æµ‹è¯•è¦†ç›–ç‡ä»0%æå‡è‡³70%+

#### ğŸš€ éƒ¨ç½²èƒ½åŠ›

- æ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²
- å®ç°è“ç»¿éƒ¨ç½²ç­–ç•¥
- å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å‚ä¸è´¡çŒ®

1. Forké¡¹ç›®åˆ°ä½ çš„GitHubè´¦æˆ·
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/amazing-feature`
3. æäº¤æ›´æ”¹ï¼š`git commit -m 'Add amazing feature'`
4. æ¨é€åˆ†æ”¯ï¼š`git push origin feature/amazing-feature`
5. åˆ›å»ºPull Request

### ä»£ç è´¡çŒ®è§„èŒƒ

- éµå¾ªç°æœ‰çš„ä»£ç é£æ ¼å’Œæ¶æ„æ¨¡å¼
- ä¸ºæ–°åŠŸèƒ½æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

### é—®é¢˜åé¦ˆ

- ä½¿ç”¨GitHub IssuesæŠ¥å‘ŠBug
- æä¾›è¯¦ç»†çš„å¤ç°æ­¥éª¤
- åŒ…å«ç³»ç»Ÿç¯å¢ƒä¿¡æ¯

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®ã€‚

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç”¨æˆ·ã€‚

---

**é¡¹ç›®çŠ¶æ€**: ğŸš€ ç”Ÿäº§å°±ç»ªï¼Œå¯ç«‹å³éƒ¨ç½² **ç»´æŠ¤çŠ¶æ€**: âœ… ç§¯æç»´æŠ¤ä¸­ **æ–‡æ¡£æ›´æ–°**:
2025-06-25
