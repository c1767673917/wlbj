#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# è¯»å–æäº¤æ¶ˆæ¯
commit_msg=$(cat $1)

echo "ğŸ“ éªŒè¯æäº¤æ¶ˆæ¯æ ¼å¼..."

# æ£€æŸ¥æäº¤æ¶ˆæ¯æ ¼å¼
# æ ¼å¼: type(scope): description
# ä¾‹å¦‚: feat(auth): æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½
if ! echo "$commit_msg" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|perf|ci|build)(\(.+\))?: .{1,50}"; then
    echo "âŒ æäº¤æ¶ˆæ¯æ ¼å¼ä¸æ­£ç¡®ï¼"
    echo ""
    echo "æ­£ç¡®æ ¼å¼: type(scope): description"
    echo ""
    echo "ç±»å‹ (type):"
    echo "  feat:     æ–°åŠŸèƒ½"
    echo "  fix:      ä¿®å¤bug"
    echo "  docs:     æ–‡æ¡£æ›´æ–°"
    echo "  style:    ä»£ç æ ¼å¼åŒ–"
    echo "  refactor: é‡æ„ä»£ç "
    echo "  test:     æµ‹è¯•ç›¸å…³"
    echo "  chore:    æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨"
    echo "  perf:     æ€§èƒ½ä¼˜åŒ–"
    echo "  ci:       CI/CDç›¸å…³"
    echo "  build:    æ„å»ºç³»ç»Ÿæˆ–å¤–éƒ¨ä¾èµ–çš„å˜åŠ¨"
    echo ""
    echo "ç¤ºä¾‹:"
    echo "  feat(auth): æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½"
    echo "  fix(api): ä¿®å¤è®¢å•æŸ¥è¯¢æ¥å£é”™è¯¯"
    echo "  docs(readme): æ›´æ–°å®‰è£…è¯´æ˜"
    echo ""
    exit 1
fi

# æ£€æŸ¥æäº¤æ¶ˆæ¯é•¿åº¦
if [ ${#commit_msg} -gt 72 ]; then
    echo "âš ï¸  æäº¤æ¶ˆæ¯è¿‡é•¿ï¼Œå»ºè®®æ§åˆ¶åœ¨72ä¸ªå­—ç¬¦ä»¥å†…"
fi

echo "âœ… æäº¤æ¶ˆæ¯æ ¼å¼éªŒè¯é€šè¿‡ï¼"
